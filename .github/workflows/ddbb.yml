name: Deploy to Both Databricks Workspaces

on:
  push:
    branches:
      - main

jobs:
  # Job to deploy to the first (development) Databricks workspace
  deploy-dev:
    runs-on: ubuntu-latest
    environment: Development
    env:
      DATABRICKS_HOST: ${{ vars.DATABRICKS_HOST }}
      DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}
      REPO_PATH: /Workspace/Users/stiletamz@gmail.com/Azure_adf_databricks_CICD/

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Databricks CLI
        uses: databricks/setup-cli@main

      - name: Update Development Databricks Git folder
        run: |
          databricks repos update ${{ env.REPO_PATH }} --branch main

  # Job to deploy to the second (production) Databricks workspace
  deploy-prod:
    runs-on: ubuntu-latest
    environment: Production
    env:
      DATABRICKS_HOST: ${{ vars.DATABRICKS_HOST_PR }}
      DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN_PR }}
      REPO_PATH: /Workspace/Users/stiletamz@gmail.com/Azure_adf_databricks_CICD/

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Databricks CLI
        uses: databricks/setup-cli@main

      - name: Update Production Databricks Git folder
        run: |
          databricks repos update ${{ env.REPO_PATH }} --branch main
